# How-to-build using OMake
#
# cp OMakeroot.in OMakeroot # to create OMakeroot for the first time

# If OMakeroot is here, include OMyMakefile
if $(file-exists OMakeroot)
   include OMyMakefile
   export

OCAMLFLAGS = -thread

####################################################### 

OCAMLINCLUDES = $(dir lib)

OCAMLPACKS[] = cryptokit str spotlib tiny_json_conv ocaml_conv # curl
CAMLP4PACKS[] = meta_conv

OCAMLDEPFLAGS= -syntax camlp4o -package meta_conv.syntax
OCAMLPPFLAGS = -syntax camlp4o -package meta_conv.syntax

Subdirs()

load_install_targets(dir) =
    chan = $(fopen $(dir)/install_targets.txt, r)
    files = $(addprefix $(dir)/, $(split $(input-line $(chan))))
    close($(chan))
#    println($(string $(files)))
    return $(files)

install: META lib/install_targets.txt twitter/install_targets.txt
    section:
        files[]= META
        files += $(load_install_targets lib)
        files += $(load_install_targets twitter)
        println($(string $(files)))
        $(OCAMLFIND) remove ocamltter 
        $(OCAMLFIND) install ocamltter $(files)

